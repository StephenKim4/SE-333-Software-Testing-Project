<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InventorySet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Project</a> &gt; <a href="index.source.html" class="el_package">data</a> &gt; <span class="el_source">InventorySet.java</span></div><h1>InventorySet.java</h1><pre class="source lang-java linenums">package data;

import command.CommandHistory;
import command.CommandHistoryFactory;

import java.util.*;

/**
 * Implementation of Inventory interface.
 * @see Data
 */
public class InventorySet implements Inventory {
  private Map&lt;Video,Record&gt; _data;
  private final CommandHistory _history;

<span class="fc" id="L16">  InventorySet() {</span>
      
<span class="fc" id="L18">    _data = new HashMap&lt;Video, Record&gt;();</span>
<span class="fc" id="L19">    _history = CommandHistoryFactory.newCommandHistory();</span>
     
<span class="fc" id="L21">  }</span>

  /**
   * If &lt;code&gt;record&lt;/code&gt; is null, then delete record for &lt;code&gt;video&lt;/code&gt;;
   * otherwise replace record for &lt;code&gt;video&lt;/code&gt;.
   * 
   * @param video     video 
   * @param record    record
   */
  void replaceEntry(Video video, Record record) {
<span class="nc" id="L31">    _data.remove(video);</span>
<span class="nc bnc" id="L32" title="All 2 branches missed.">    if (record != null)</span>
<span class="nc" id="L33">      _data.put(video,((RecordObj)record).copy());</span>
<span class="nc" id="L34">  }</span>

  /**
   * Overwrite the map.
   * 
   * @param data inventory map
   */
  void replaceMap(Map&lt;Video,Record&gt; data) {
<span class="fc" id="L42">    _data = data;</span>
<span class="fc" id="L43">  }</span>

  public int size() {
<span class="fc" id="L46">    return _data.size();</span>
  }

  public Record get(Video v) {
<span class="fc" id="L50">    return _data.get(v);</span>
  }

  public Iterator&lt;Record&gt; iterator() {
<span class="nc" id="L54">    return Collections.unmodifiableCollection(_data.values()).iterator();</span>
  }

  public Iterator&lt;Record&gt; iterator(Comparator&lt;Record&gt; comparator) {
    
<span class="nc" id="L59">	  List&lt;Record&gt; l = new ArrayList&lt;Record&gt;(_data.values());</span>
<span class="nc" id="L60">	  l.sort(comparator);</span>
	  //Collections.sort(l, comparator);
	  
<span class="nc" id="L63">	  return Collections.unmodifiableCollection(l).iterator();</span>
  }

  /**
   * Add or remove copies of a video from the inventory.
   * If a video record is not already present (and change is
   * positive), a record is created. 
   * If a record is already present, &lt;code&gt;numOwned&lt;/code&gt; is
   * modified using &lt;code&gt;change&lt;/code&gt;.
   * If &lt;code&gt;change&lt;/code&gt; brings the number of copies to be less
   * than one, the record is removed from the inventory.
   * @param video the video to be added.
   * @param change the number of copies to add (or remove if negative).
   * @return A copy of the previous record for this video (if any)
   * @throws IllegalArgumentException if video null or change is zero
   */
  Record addNumOwned(Video video, int change) {
<span class="fc bfc" id="L80" title="All 2 branches covered.">    if (video == null)</span>
<span class="fc" id="L81">      throw new NullPointerException();</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">    if (change == 0)</span>
<span class="fc" id="L83">      throw new IllegalArgumentException();</span>
<span class="fc" id="L84">    RecordObj r = (RecordObj) _data.get(video);</span>
<span class="pc bpc" id="L85" title="1 of 4 branches missed.">    if (r == null &amp;&amp; change &lt; 1) {</span>
<span class="nc" id="L86">      throw new IllegalArgumentException();</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">    } else if (r == null) {</span>
<span class="fc" id="L88">      _data.put(video, new RecordObj(video, change, 0, 0));</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">    } else if (r.numOwned+change &lt; r.numOut) {</span>
<span class="fc" id="L90">      throw new IllegalArgumentException();</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">    } else if (r.numOwned+change &lt; 1) {</span>
<span class="fc" id="L92">      _data.remove(video);</span>
    } else {
<span class="fc" id="L94">      _data.put(video, new RecordObj(video, r.numOwned + change, r.numOut, r.numRentals));</span>
    }
<span class="fc" id="L96">    return r;</span>
  }

  /**
   * Check out a video.
   * @param video the video to be checked out.
   * @return A copy of the previous record for this video
   * @throws IllegalArgumentException if video has no record or numOut
   * equals numOwned.
   */
  Record checkOut(Video video) {
    
<span class="fc bfc" id="L108" title="All 2 branches covered.">	  if (!_data.containsKey(video)) {</span>
<span class="fc" id="L109">	    	throw new IllegalArgumentException(&quot;Video has no record&quot;);</span>
	    }
<span class="fc bfc" id="L111" title="All 2 branches covered.">	    if (_data.get(video).numOut() == _data.get(video).numOwned() ) {</span>
<span class="fc" id="L112">	    	throw new IllegalArgumentException(&quot;All videos are checked out&quot;);</span>
	    }
<span class="fc" id="L114">	Record c = new RecordObj(video, _data.get(video).numOwned(), _data.get(video).numOut(), _data.get(video).numRentals());    </span>
<span class="fc" id="L115">  	Record r = new RecordObj(video, _data.get(video).numOwned(), _data.get(video).numOut() + 1, _data.get(video).numRentals() + 1);</span>
<span class="fc" id="L116">  	_data.replace(video, r);</span>
	
<span class="fc" id="L118">  	return c;</span>
  }
  
  /**
   * Check in a video.
   * @param video the video to be checked in.
   * @return A copy of the previous record for this video
   * @throws IllegalArgumentException if video has no record or numOut
   * non-positive.
   */
  Record checkIn(Video video) {
	  
<span class="fc bfc" id="L130" title="All 2 branches covered.">	  if (!_data.containsKey(video)) {</span>
<span class="fc" id="L131">		  	throw new IllegalArgumentException(&quot;Video has no record&quot;);</span>
		  }
<span class="fc bfc" id="L133" title="All 2 branches covered.">		  if (_data.get(video).numOut() &lt; 1 ) {</span>
<span class="fc" id="L134">		   	throw new IllegalArgumentException(&quot;There are no videos checked out&quot;);</span>
		  }
		  
<span class="fc" id="L137">      Record c = new RecordObj(video, _data.get(video).numOwned(), _data.get(video).numOut(), _data.get(video).numRentals());    </span>
<span class="fc" id="L138">	  Record r = new RecordObj(video, _data.get(video).numOwned(), _data.get(video).numOut() - 1, _data.get(video).numRentals());</span>
<span class="fc" id="L139">	  _data.replace(video, r);</span>
	  
<span class="fc" id="L141">	  return c;</span>
  }
  
  /**
   * Remove all records from the inventory.
   * @return A copy of the previous inventory as a Map
   */
  Map clear() {
	  
<span class="fc" id="L150">	Map&lt;Video, Record&gt; newMap = new HashMap&lt;Video, Record&gt;();</span>
	
<span class="fc" id="L152">	newMap.putAll(_data);</span>
	
<span class="fc" id="L154">    _data.clear();</span>
    
<span class="fc" id="L156">	return newMap;</span>
  }

  /**
   * Return a reference to the history.
   * 
   * @return CommandHistory history
   */
  CommandHistory getHistory() {
     
<span class="nc" id="L166">    return _history;</span>
  }
  
  public String toString() {
<span class="fc" id="L170">    StringBuffer buffer = new StringBuffer();</span>
<span class="fc" id="L171">    buffer.append(&quot;Database:\n&quot;);</span>
<span class="fc" id="L172">    Iterator i = _data.values().iterator();</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">    while (i.hasNext()) {</span>
<span class="fc" id="L174">      buffer.append(&quot;  &quot;);</span>
<span class="fc" id="L175">      buffer.append(i.next());</span>
<span class="fc" id="L176">      buffer.append(&quot;\n&quot;);</span>
    }
<span class="fc" id="L178">    return buffer.toString();</span>
  }


  /**
   * Implementation of Record interface.
   *
   * &lt;p&gt;This is a utility class for Inventory.  Fields are mutable and
   * package-private.&lt;/p&gt;
   *
   * &lt;p&gt;&lt;b&gt;Class Invariant:&lt;/b&gt; No two instances may reference the same Video.&lt;/p&gt;
   *
   * @see Record
   */
  static class RecordObj implements Record {
    Video video; // the video
    int numOwned;   // copies owned
    int numOut;     // copies currently rented
    int numRentals; // total times video has been rented
    
<span class="fc" id="L198">    RecordObj(Video video, int numOwned, int numOut, int numRentals) {</span>
<span class="fc" id="L199">      this.video = video;</span>
<span class="fc" id="L200">      this.numOwned = numOwned;</span>
<span class="fc" id="L201">      this.numOut = numOut;</span>
<span class="fc" id="L202">      this.numRentals = numRentals;</span>
<span class="fc" id="L203">    }</span>

    RecordObj copy() {
<span class="fc" id="L206">      return new RecordObj(video, numOwned, numOut, numRentals);</span>
    }

    public Video video() {
<span class="fc" id="L210">      return video;</span>
    }

    public int numOwned() {
<span class="fc" id="L214">      return numOwned;</span>
    }

    public int numOut() {
<span class="fc" id="L218">      return numOut;</span>
    }

    public int numRentals() {
<span class="fc" id="L222">      return numRentals;</span>
    }

    public boolean equals(Object thatObject) {
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">      if (thatObject == null) {</span>
<span class="nc" id="L227">        return false;</span>
      }
<span class="fc" id="L229">      return video.equals(((Record)thatObject).video());</span>
    }


    public int hashCode() {
<span class="fc" id="L234">      return video.hashCode();</span>
    }


    public String toString() {
<span class="fc" id="L239">      StringBuffer buffer = new StringBuffer();</span>
<span class="fc" id="L240">      buffer.append(video);</span>
<span class="fc" id="L241">      buffer.append(&quot; [&quot;);</span>
<span class="fc" id="L242">      buffer.append(numOwned);</span>
<span class="fc" id="L243">      buffer.append(&quot;,&quot;);</span>
<span class="fc" id="L244">      buffer.append(numOut);</span>
<span class="fc" id="L245">      buffer.append(&quot;,&quot;);</span>
<span class="fc" id="L246">      buffer.append(numRentals);</span>
<span class="fc" id="L247">      buffer.append(&quot;]&quot;);</span>
<span class="fc" id="L248">      return buffer.toString();</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>